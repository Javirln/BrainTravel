{% extends 'base.html' %} {% block title %} My trips {% endblock %} 
{% block content %} {% load i18n %} {% load staticfiles %}
<div class="container">
    <!-- <div id="carousel-example-generic" class="carousel slide" data-ride="carousel">
            <div class="carousel-inner" role="listbox">
                {% for day in trip.day_set.all %}
                    {% for venue in day.venues.all %}
                        <div class="item {% if forloop.first %}active{% endif %}">
                            <img alt="{{venue.name}}" src="{{venue.photo}}" class="img-venue-carousel"/>
                            <div class="carousel-caption">
                               <h4>{{venue.name}}</h4>
                            </div>
                        </div>
                    {% endfor %}
                {% endfor %}
            </div>

          Controls
          <a class="left carousel-control" href="#carousel-example-generic" role="button" data-slide="prev">
            <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
            <span class="sr-only">Previous</span>
          </a>
          <a class="right carousel-control" href="#carousel-example-generic" role="button" data-slide="next">
            <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
            <span class="sr-only">Next</span>
          </a>
        </div>
         -->
    <h1>Trip details</h1>
    <div class="row">
        <div id="map" style="height: 500px;"></div>
    </div>
    <h2>{{trip.day_set.count}} days in {{trip.city}}, {{trip.country}}</h2>
    <p>Click on the day indicator to show te corresponding plan</p>

    <div class="panel-group" id="accordion" role="tablist"
        aria-multiselectable="true">
        {% for day in trip.day_set.all %}
        <div
            class="panel panel-{% cycle 'primary' 'success' 'info' 'warning' 'danger' %}">
            <div class="panel-heading" role="tab" id="heading{{day.numberDay}}">
                <h4 class="panel-title">
                    <a data-toggle="collapse" data-parent="#accordion"
                        href="#collapse{{day.numberDay}}" aria-expanded="true"
                        aria-controls="collapse{{day.numberDay}}">Day {{day.numberDay}}</a>
                </h4>
            </div>
            <div id="collapse{{day.numberDay}}"
                class="panel-collapse collapse {% if forloop.first %}in{% endif %}"
                role="tabpanel" aria-labelledby="headin{{day.numberDay}}">
                <div class="panel-body">
                    <h3>
                        <i class="fa fa-map-marker"></i> Those are the venues that we
                        suggest to visit on day {{day.numberDay}}
                    </h3>
                    <div class="row text-center">
                        {% for venue in day.venues.all %} {% if not venue.is_food%}
                        <div class="col-sm-4 col-xs-6 col-md-4 col-lg-3 clearfix">
                            <img src="{{venue.photo}}"
                                class="img-responsive img-thumbnail img-venue" onerror="this.src='{% static "img/no-image.png" %}'" data-toggle="modal" data-target="#tipInfo" onclick=show_modal_tips({{venue.id}})>
                            <h4>{{venue.name}}</h4>
                        </div>
                        {% if forloop.counter|divisibleby:2 %}
						<div class="clearfix visible-xs-block"></div>
						{% endif %}
						
						{% if forloop.counter|divisibleby:4 %}
						<div class="clearfix visible-sm-block visible-md-block visible-lg-block"></div>
						{% endif %} {% endif %} {% endfor %}
                    </div>

                    <h3>
                        <i class="fa fa-cutlery"></i> Those are the places where we suggest
                        you to eat on day {{day.numberDay}}
                    </h3>
                    <div class="row text-center">
                        {% for venue in day.venues.all %} {% if venue.is_food%}
                        <div class="col-sm-4 col-xs-6 col-md-4 col-lg-3 clearfix">
                            <img src="{{venue.photo}}"
                                class="img-responsive img-thumbnail img-venue" onerror="this.src='{% static "img/no-image.png" %}'" data-toggle="modal" data-target="#tipInfo" onclick=show_modal_tips({{venue.id}})>
                            <h4>{{venue.name}}</h4>
                        </div>
                        {% if forloop.counter|divisibleby:2 %}
						<div class="clearfix visible-xs-block"></div>
						{% endif %}
						
						{% if forloop.counter|divisibleby:4 %}
						<div class="clearfix visible-sm-block visible-md-block visible-lg-block"></div>
						{% endif %} {% endif %} {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
    <script>
    var infowindow = null;
    function initialize() {
        var address = "{{ trip.city }}" + ", " + "{{ trip.country }}";
        geocoder = new google.maps.Geocoder();
        geocoder.geocode({ 'address': address}, function (results, status) {
            if (status == google.maps.GeocoderStatus.OK) {
                var mapOptions = {
                    zoom: 15,
                    center: results[0].geometry.location
                };
                var map = new google.maps.Map(document.getElementById('map'), mapOptions);
                var bounds = new google.maps.LatLngBounds();
                var infoWindow = new google.maps.InfoWindow();
                {% for day in trip.day_set.all %}
                    {% for venue in day.venues.all %}
                        var coordinates = new google.maps.LatLng({{ venue.latitude }}, {{ venue.longitude }});
                        var marker = new google.maps.Marker({
                            map: map,
                            icon: {% if venue.is_food == True %} "{% static "img/icons/restaurant-24.svg" %}" {% else %} "{% static "img/icons/marker-24.svg" %}" {% endif %},
                            position: coordinates
                        });
                        google.maps.event.addListener(marker, 'click', function () {
                            infoWindow.setContent("{{ venue.name }}");
                            infoWindow.open(map, this);
                        });
                        bounds.extend(coordinates);
                    {% endfor %}
                {% endfor %}
                map.fitBounds(bounds);
            } else {
                alert('Geocode was not successful for the following reason: ' + status);
            }
        });
    }
    google.maps.event.addDomListener(window, 'load', initialize);
/*
    function show_modal_tips(id_venue) {
		$.ajax({
	        url : "/venue_tips/"+id_venue, // the endpoint
	        type : "GET", // http method
			dataType : "JSON",
	        // handle a successful response
	        success : function(json) {
                $("#tip_placement").text(json);
			},

	        // handle a non-successful response
	        error : function(xhr,errmsg,err) {
                alert("error");
	        }
	    });
	};
	*/
    </script>
{% endblock %}
