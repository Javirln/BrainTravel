{% extends 'base.html' %}
{% block title %} Details {% endblock %}
{% block content %}
<div class="container">
    <h1>{{trip.name}}</h1>
    <div class="row">
        <div class="col-lg-12">
            <div class="media well">
                <div class="row">
                    <div class="col-xs-12 col-md-2 col-sm-2 col-lg-2 text-center">
                        <div>
                            <img class="avatar img-circle img-thumbnail" src="/{{trip.traveller.photo}}" width="64" title="{{trip.traveller.first_name}}">
                            <p>
                                <strong><a href="/profile/{{trip.traveller.id}}">{{trip.traveller}}</a></strong>
                                {% if trip.traveller.reputation != None %}
                                <br><i class="fa fa-star"></i> {{ trip.traveller.reputation }} / 10
                                {% endif %}
                            </p>
                        </div>
                    </div>
                    <div class="col-xs-12 col-sm-10 col-lg-10 col-md-10">
                        <div class="text-justify media-body">
                            <blockquote>
                                <p class="text-right"><i class="fa fa-globe fa"></i>  {{ trip.city }}, {{ trip.country }}</p>
                                <p><i class="fa fa-calendar fa"></i>  {{ trip.startDate }} - {{ trip.endDate }}</p>
                                <p>{{trip.publishedDescription|safe}}</p>
                                <ul class="list-inline list-unstyled">
                                    {% if user.is_anonymous or perms.principal.administrator or trip.state != 'ap' %}
                                        <li><i class="fa fa-thumbs-o-up fa"></i> {{trip.likes}}</li>
                                        <li>|</li>
                                        <li><i class="fa fa-thumbs-o-down fa"></i> {{trip.dislikes}}</li>
                                        <li>|</li>
                                    {% endif %}
                                    {% if perms.principal.traveller and trip.state == 'ap'%}
                                        {% if judge == None %}
                                            <li><a href="/judge/{{trip.scorable_ptr_id}}/1" style="text-decoration: None"><i class="fa fa-thumbs-o-up fa"></i> {{trip.likes}}</a></li>
                                            <li>|</li>
                                            <li><a href="/judge/{{trip.scorable_ptr_id}}/0" style="text-decoration: None"><i class="fa fa-thumbs-o-down fa"></i> {{trip.dislikes}}</a></li>
                                        {% elif judge.like == True %}
                                            <li><a href="/judge/{{trip.scorable_ptr_id}}/1" style="text-decoration: None"><i class="fa fa-thumbs-up fa"></i> {{trip.likes}}</a></li>
                                            <li>|</li>
                                            <li><a href="/judge/{{trip.scorable_ptr_id}}/0" style="text-decoration: None"><i class="fa fa-thumbs-o-down fa"></i> {{trip.dislikes}}</a></li>
                                        {% else %}
                                            <li><a href="/judge/{{trip.scorable_ptr_id}}/1" style="text-decoration: None"><i class="fa fa-thumbs-o-up fa"></i> {{trip.likes}}</a></li>
                                            <li>|</li>
                                            <li><a href="/judge/{{trip.scorable_ptr_id}}/0" style="text-decoration: None"><i class="fa fa-thumbs-down fa"></i> {{trip.dislikes}}</a></li>
                                        {% endif %}
                                        <li>|</li>
                                    {% endif %}
                                    {% if assessment == None %}
                                        <li><i class="fa fa-star-o fa"  style="text-decoration: None"></i> {% firstof trip.rating '-' %} / <strong>10</strong></li>
                                    {% else %}
                                        <li><i class="fa fa-star fa"  style="text-decoration: None"></i> {% firstof trip.rating '-' %} / <strong>10</strong></li>
                                    {% endif %}
                                </ul>
                                {% if user.traveller.id == trip.traveller.id %}
                                    <p><br><a href="/trip/edit/{{trip.scorable_ptr_id}}"><i class="fa fa-pencil"></i> Edit</a></p>
                                {% endif %}
                                {% if perms.principal.traveller and trip.state == 'ap' and trip.traveller.id != user.id and assessment == None%}
                                    <div class="center-block">
                                        <button style="width: 100%;" type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal">Rate this trip!</button>
                                    </div>
                                {% endif %}
                            </blockquote>
                            {% if perms.principal.administrator %}
                                <div class="well">
                                    <h3>Trip moderation</h3>
                                    <p>Select an option and click save to change the trip status.</p>
                                    <form class="form-horizontal" role="form" action="/administrator/trip/update/{{ trip.id }}" method="post" data-toggle="validator">
                                        {% csrf_token %}
                                        <div class="form-group {% if form.visible_fields.0.errors %} has-error {% endif %}">
                                            {{ form.visible_fields.0 }}
                                            <div class="help-block with-errors">
                                                {{ form.visible_fields.0.errors }}
                                            </div>
                                        </div>
                                        {% for hidden in form.hidden_fields %}
                                            {{ hidden }}
                                        {% endfor %}
                                        <button type="submit" name="save" value="save" onclick="return confirm('Are you sure?')" class="btn btn-block btn-danger">Save</button>
                                    </form>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            <div class="timeline-centered">
                {% if not perms.administrator and not user.is_anonymous %}
                    <article class="timeline-entry entry">
                        <div class="timeline-entry-inner">
                            <div class="timeline-icon" style="-webkit-transform: rotate(-90deg); -moz-transform: rotate(-90deg);">
                                <i class="entypo-flight" style="text-decoration: None"></i> +
                            </div>
                            <div class="timeline-label">
                                <form class="form" method="post" action="comment/" id="form-comment-id">
                                    {% csrf_token %}
                                    <div class="form-group">
                                        <textarea id="text-comment" class="form-control input-block-level" name="text-comment" rows="3" style="resize: none;"></textarea>
                                    </div>
                                    <div class="form-group text-right">
                                        <button id="submit-comment" type="submit" class="btn btn-success">Send</button>
                                        <input type="hidden" name="trip-id" value="{{trip.id}}"/>
                                        <input type="hidden" name="last-path" value="{{ request.path }}"/>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </article>
                {% endif %}
                {% for comment in comments %}
                    {% if comments.last %}
                        <article class="timeline-entry begin">
                            <div class="timeline-entry-inner">
                                <div class="timeline-icon">
                                    <img class="img-circle" style="width: 40px; height: 40px;" src="/{{ comment.traveller.photo }}">
                                </div>
                                <div class="timeline-label">
                                    <h2><a href="#">{{comment.traveller}} says:</a></h2>
                                    <!--<br>-->
                                    <i class="fa fa-quote-left fa-1x pull-left"></i>
                                    {{comment.description|safe}}
                                </div>
                            </div>
                        </article>
                    {% else %}
                        <article class="timeline-entry">
                            <div class="timeline-entry-inner">
                                <div class="timeline-icon bg-success">
                                    <i class="entypo-suitcase"></i>
                                    <img class="img-circle" style="width: 40px; height: 40px;" src="/{{ comment.traveller.photo }}">
                                </div>
                                <div class="timeline-label">
                                    <h2><a href="#">{{comment.traveller}} says:</a></h2>
                                    <!--<br>-->
                                    <i class="fa fa-quote-left fa-1x pull-left"></i>
                                    {{comment.description|safe}}
                                </div>
                            </div>
                        </article>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">Rate this trip</h4>
                </div>
                <div class="modal-body">
                    <form class="form" method="post" action="rate/" id="form-rate-id">
                        {% csrf_token %}
                        <div class="form-group">
                            <p>Please choose a number between 0 and 10:</p>
                            <input type="number" name="rate-value" min="0" max="10" required/>
                            <p>Please, write a fancy description:</p>
                            <textarea id="text-comment" class="form-control input-block-level" name="text-rate-description" rows="3" required maxlength="255" style="resize: none;"></textarea>
                        </div>
                        <div class="modal-footer">
                            <div class="form-group">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                <button id="submit-comment" type="submit" class="btn btn-success">Send</button>
                                <input type="hidden" name="trip-id" value="{{trip.id}}"/>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}